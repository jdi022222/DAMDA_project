<html layout:decorate="~{layout/layout}">
<head>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Poppins:300,400,500&display=swap" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/calendar-19/fonts/icomoon/style.css}">
    <link th:href='@{/calendar-19/fullcalendar/packages/core/main.css}' rel='stylesheet'/>
    <link th:href='@{/calendar-19/fullcalendar/packages/daygrid/main.css}' rel='stylesheet'/>
    <!-- Bootstrap CSS -->
    <!--<link rel="stylesheet" th:href="@{/calendar-19/css/bootstrap.min.css}">-->
    <!-- Style -->
    <link rel="stylesheet" th:href="@{/calendar-19/css/style.css}">
</head>
<div layout:fragment="content" class="mt-3 container justify-content-around"
     style="width: 95%; min-height: 100%; position:relative;">
    <input type="hidden" name="plan_id" th:value="${plan.id}">
    <input type="hidden" name="plan_size" th:value="${plan.size}">
    <input type="hidden" name="course" th:value="${course}">
    <button onclick="spotsPrint();">testbutton</button>
    <!--제목과 수정, 삭제 버튼-->
    <div class="justify-content-between d-flex mb-2" style="height: 10%;">
        <h1 th:text="${plan.title}"></h1>
        <div class="d-flex w-25" style="align-items: center;">
            <a class="w-50 h-100 btn btn-info mr-2" style="align-items: center;"
               th:href="@{|/travel/design/modification/${plan.id}?order=1|}">수정
            </a>
            <a class="w-50 h-100 btn btn-danger" onclick="if(!confirm('정말로 삭제하시겠습니까?')) return false;"
               style="align-items: center;"
               th:href="@{|/travel/design/plan/delete/${plan.id}|}">삭제
            </a>
        </div>
    </div>
    <!--일차 이동 바-->
    <div class="w-100 d-flex mb-2 justify-content-start" style="height: 10%; white-space: nowrap; overflow: auto;">
        <div class="card card py-3 px-5 mr-2" th:each="courses : ${plan.courseList}">
            <a th:if="${courses.id != course.id}"
               th:href="@{|/travel/design/plan/detail/${plan.id}?order=${courses.orders}|}"
               th:text="|${courses.orders}일차|"></a>
            <a class="font-weight-bold" th:if="${courses.id == course.id}" th:text="|${courses.orders}일차|"></a>
        </div>
    </div>
    <!--여행지 코스 정보 / 지도 + 캘린터-->
    <div class="justify-content-around d-flex" style="max-height: 80%;">
        <div style="width: 45%; height: 100%;">
            <!--코스 정보-->
            <div class="card card overflow-scroll container mx-1 row" style="width:100%; max-height:100%;">
                <div class="border-bottom border-1 py-1 my-1 d-flex overflow-scroll"
                     th:each="spot, loop : ${course.spotList}">
                    <div>
                        <h3 style="align-items: center; white-space: nowrap;" href="#" th:text="|${spot.name}|"></h3>
                        <a th:href="@{|http://place.map.kakao.com/${spot.urlId}|}" style="white-space: nowrap;"
                           target="_blank">카카오 맵에서 보기</a>
                    </div>
                </div>
            </div>
            <!--지도-->
            <div class="card card container mt-2" style="width:100%; min-height:100%;">
                <div id="map" style="width:100%;height:350px;"></div>

                <script type="text/javascript"
                        src="//dapi.kakao.com/v2/maps/sdk.js?appkey=3398f87064ef2d4f364684990589c167&libraries=services"></script>
                <script th:inline="javascript">

                    var mapContainer = document.getElementById('map'), // 지도를 표시할 div
                        mapOption = {
                            center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
                            level: 10 // 지도의 확대 레벨
                        };

                    // 지도를 생성합니다
                    var map = new kakao.maps.Map(mapContainer, mapOption);


                    // 주소-좌표 변환 객체를 생성합니다
                    var geocoder = new kakao.maps.services.Geocoder();

                    var positions = [
                        {
                            title: '카카오',
                            address: '경기 성남시 분당구 판교역로 166 카카오 판교아지트 A동 3층'
                        },
                        {
                            title: '생태연못',
                            address: '경기 남양주시 조안면 능내리 50'
                        },
                        {
                            title: '근린공원',
                            address: '경기 남양주시 별내면 청학로68번길 40'
                        }
                    ];

                    function addPositions(spot) {

                    }

                    for (var i = 0; i < spots.length; i++) {
                        // 주소로 좌표를 검색합니다
                        geocoder.addressSearch(spots[i].address, function (result, status) {

                            // 정상적으로 검색이 완료됐으면
                            if (status === kakao.maps.services.Status.OK) {

                                var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                                // 결과값으로 받은 위치를 마커로 표시합니다
                                var marker = new kakao.maps.Marker({
                                    map: map,
                                    position: coords
                                });

                                // 인포윈도우로 장소에 대한 설명을 표시합니다
                                var infowindow = new kakao.maps.InfoWindow({
                                    content: '<div style="width:150px;text-align:center;padding:6px 0;">${spots[i].name}</div>'
                                });
                                infowindow.open(map, marker);

                                // 지도의 중심을 결과값으로 받은 위치로 이동시킵니다
                                map.setCenter(coords);
                            }
                        });
                    }
                </script>
                <!--지도 끝-->
            </div>
        </div>
        <!--        <div class="content">-->
        <div style="width: 45%;" id='calendar'></div>
    </div>

    <!--            <script th:src="@{/calendar-19/js/jquery-3.3.1.min.js}"></script>-->
    <script th:src="@{/calendar-19/js/popper.min.js}"></script>
    <!--            <script th:src="@{calendar-19/js/bootstrap.min.js}"></script>-->

    <script th:src='@{/calendar-19/fullcalendar/packages/core/main.js}'></script>
    <script th:src='@{/calendar-19/fullcalendar/packages/interaction/main.js}'></script>
    <script th:src='@{/calendar-19/fullcalendar/packages/daygrid/main.js}'></script>

    <script th:inline="javascript">
        // window.onload = function () {
        //     spotsPrint();
        // }
        var plan_id = $('input[name=plan_id]').val();
        var plan_size = $('input[name=plan_size]').val();
        var spots = [[${spotList}]];
        var size = plan_size;
        var plan_startDate = [[${plan.startDate}]];
        function spotsPrint() {
            console.log('planId : ' + plan_id,
                'size : ' + size,
                'spots : ' + spots);
            addEvent();
        }
        function addEvent() {
            for(var i = 0; i < plan_size; i++) {
                // eventList[i] = {
                //     title: `${i}일차`,
                //     start: plan_plan.startDate,
                //     url: `/travel/design/plan/detail/${plan_id}?order=${i+1}`
                // }
                console.log('title: ' + `${i+1}일차 ` + 'start:' +  plan_startDate + ' url:' + `/travel/design/plan/detail/${plan_id}?order=${i+1}`);
            }
        }
        var eventList = [
            {
                title: 'TODAY',
                start: Date.now()
            },

            {
                title: 'Click for Google',
                url: 'http://google.com/',
                start: '2022-09-28'
            }
        ]
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                plugins: ['interaction', 'dayGrid'],
                defaultDate: Date.now(),
                editable: true,
                eventLimit: true, // allow "more" link when too many events
                events: eventList
            });

            calendar.render();
        });

    </script>

    <script th:src="@{/calendar-19/js/main.js}"></script>

    <!--    </div>-->
</div>
</html>